# Code Editing and Publishing Guide

## Overview

The Code Editing and Publishing features provide a comprehensive system for reviewing, editing, and deploying Python execution code generated by PyBIRD AI workflows. This system is primarily used in the ANCRDT Workflow Step 3 Review, allowing you to refine generated code and manage its deployment from staging to production.

The system offers several key capabilities that streamline your workflow. You can review generated Python execution code directly in your browser, edit code using browser-based editors powered by Monaco Editor, and validate Python syntax before deployment to catch errors early. The system allows you to deploy code from staging to production with confidence, track deployment status and manual modifications to maintain awareness of changes, manage backups automatically to prevent data loss, and work with multiple files simultaneously for efficient editing sessions.

You can primarily access these features through the ANCRDT Workflow Step 3 Review at `/pybirdai/ancrdt-workflow/step-3/review/` or through the Main Workflow Step 3 Review.

---

## System Architecture

### Code Lifecycle

```
Generation (Step 3 Execute)
    ↓
Staging Area: results/generated_python_joins/
    ↓
[Review & Edit] (Step 3 Review)
    ↓
[Deployment]
    ↓
Production: pybirdai/process_steps/filter_code/
    ↓
[Execution] (Step 4)
```

### Directories

The system uses three main directory areas for managing code files. The Staging Area is located at `results/generated_python_joins/` and serves to hold newly generated or modified code. This area is fully editable and provides a safe space to work on files before they're deployed to production. However, code in this area is not used during execution, making it ideal for testing and refinement.

The Production Area is located at `pybirdai/process_steps/filter_code/` and contains deployed code that is actually used during execution. Files in this area can only be modified through the deployment process, ensuring that production code remains controlled and tracked. All code executed by the system runs from this location.

The Backup Area is located at `pybirdai/process_steps/filter_code/backups/` and stores automatic backups created before each deployment. Files are saved with a naming convention of `<filename>.backup_<timestamp>`, such as `ANCRDT_INSTRMNT_C_1_logic.py.backup_20250117_103045`, making it easy to identify when each backup was created and restore previous versions if needed.

### File Types

**Generated ANCRDT Files:**

The system generates ANCRDT files following a consistent pattern of `ANCRDT_<TABLE_NAME>_logic.py`. Examples of these files include `ANCRDT_INSTRMNT_C_1_logic.py`, `ANCRDT_FNNCL_C_2_logic.py`, and `ANCRDT_CNTRPRTY_C_3_logic.py`. A typical ANCRDT workflow generates between 20 and 30 files, each corresponding to a specific table in the regulatory framework.

**File Structure:**
```python
class ANCRDT_<TABLE_NAME>:
    """Generated join logic for <TABLE_NAME> table"""

    def __init__(self, context):
        self.context = context
        self.cube_id = "<TABLE_NAME>"

    def calc_<table_name_lower>(self, filters=None):
        """Main calculation method with optional filters"""
        # Join logic
        # Filter application
        # Return DataFrame

    def apply_filters(self, df, filters):
        """Apply dimension filters to DataFrame"""
        # Filter logic

    # Additional helper methods...
```

---

## Deployment Status Dashboard

### Access
**URL:** `/pybirdai/ancrdt-workflow/step-3/review/`

**Location:** Top section of Step 3 Review page

### Interface

**Statistics Summary:**
```
Deployment Status:
✓ Total files generated: 28
✓ Files synced to production: 18 (64%)
⚠ Files not deployed: 10 (36%)
ℹ Files manually edited: 2 (7%)
```

**Action Buttons:**
- **Deploy All Now** - Deploy all unsynced files in batch
- **Refresh Status** - Reload deployment statistics

**Files List Table:**

| File Name | Size | Sync Status | Edit Status | Actions |
|-----------|------|-------------|-------------|---------|
| ANCRDT_INSTRMNT_C_1_logic.py | 45 KB | ✓ Synced | Generated | Edit \| View Diff |
| ANCRDT_FNNCL_C_2_logic.py | 125 KB | Not Synced | Generated | Edit \| Deploy |
| ANCRDT_LARGE_TABLE_logic.py | 320 KB | Not Synced | Generated | View \| Deploy |
| ANCRDT_CNTRPRTY_C_3_logic.py | 62 KB | ✓ Synced | Edited | Edit \| View Diff |

**Column Details:**

The File Name column displays clickable links that allow you to view or edit each file directly. By default, files are sorted alphabetically to make them easy to locate.

The Size column shows the file size with color coding to help you quickly identify which files can be edited in the browser. Green indicates files smaller than 100 KB that can be edited easily in the browser. Yellow marks files between 100-300 KB that can still be edited in the browser but may experience slower performance. Red identifies files larger than 300 KB that are too large for the browser editor and can only be viewed.

The Sync Status column indicates the relationship between staging and production versions of each file. A green "✓ Synced" status means the file has been deployed to production and the staging and production versions match exactly. A yellow "Not Synced" status indicates the file only exists in staging and hasn't yet been deployed. An orange "Modified" status shows that a production file exists but differs from the staging version, requiring review before deployment.

The Edit Status column tracks whether files have been manually modified after generation. The default "Generated" status means the file remains as it was auto-generated with no manual edits. A blue "Edited" status indicates the production file has been manually modified after deployment. A gray "Unmodified" status shows the file has not been edited.

The Actions column provides several buttons for working with each file. The "Edit" button appears for files smaller than 300 KB and opens the individual code editor. The "View" button appears for files 300 KB or larger and opens a read-only viewer. The "Deploy" button allows you to deploy that specific file to production. The "View Diff" button appears when statuses differ between staging and production, allowing you to see the differences between the two versions.

### Usage

#### View Deployment Status

1. Navigate to ANCRDT Step 3 Review page
2. Deployment Status Dashboard loads automatically
3. Review statistics summary
4. Scroll through files list

#### Deploy All Unsynced Files

1. Review statistics - note how many files are unsynced
2. Click **"Deploy All Now"** button
3. Confirmation dialog appears:
   ```
   Deploy all unsynced files to production?
   This will deploy 10 files.
   Backups will be created automatically.
   ```
4. Click **"Confirm"**
5. Progress indicator shows deployment
6. Wait for completion (typically 5-30 seconds)
7. Success message displays:
   ```
   Deployment Complete:
   ✓ Successfully deployed: 10 files
   ✗ Failed: 0 files
   ```
8. Statistics update automatically
9. Review updated file statuses

#### Deploy Individual File

1. Locate file to deploy in Files List
2. Check that **Sync Status** shows "Not Synced"
3. Click **"Deploy"** button in Actions column
4. Confirmation dialog:
   ```
   Deploy ANCRDT_FNNCL_C_2_logic.py to production?
   A backup will be created if the file already exists.
   ```
5. Click **"Confirm"**
6. AJAX request deploys file
7. Success message: "File deployed successfully"
8. File status updates to "✓ Synced"

#### View File Differences

1. Locate file with differing statuses in Files List
2. Click **"View Diff"** button
3. Opens diff viewer page showing:
   - **Left panel:** Staging version
   - **Right panel:** Production version
   - Side-by-side comparison with highlighted differences

**Diff viewer features:**
- Line-by-line comparison
- Added lines highlighted in green
- Deleted lines highlighted in red
- Modified lines highlighted in yellow
- Line numbers for easy reference
- Collapse unchanged sections

#### Refresh Status

1. Click **"Refresh Status"** button
2. System re-checks all file statuses
3. Statistics update
4. Useful after external changes (manual file edits, deployments from other sessions)

### API Endpoints

**Get deployment status:**
```
GET /pybirdai/code-sync/status/
Response: {
  "statistics": {
    "total_files": 28,
    "synced": 18,
    "not_synced": 10,
    "edited": 2
  },
  "files": [
    {
      "file_name": "ANCRDT_INSTRMNT_C_1_logic.py",
      "size": 45632,
      "is_synced": true,
      "is_edited": false,
      "staging_exists": true,
      "production_exists": true,
      "staging_modified": "2025-01-17T10:30:00",
      "production_modified": "2025-01-17T10:30:00"
    },
    ...
  ]
}
```

**Deploy single file:**
```
POST /pybirdai/code-sync/deploy/
Body: {
  "file_name": "ANCRDT_FNNCL_C_2_logic.py",
  "create_backup": true
}
Response: {
  "success": true,
  "message": "File deployed successfully",
  "backup_created": "ANCRDT_FNNCL_C_2_logic.py.backup_20250117_103045"
}
```

**Deploy all files:**
```
POST /pybirdai/code-sync/deploy-all/
Response: {
  "success": true,
  "deployed": 10,
  "failed": 0,
  "details": [...]
}
```

**View diff:**
```
GET /pybirdai/code-sync/diff/<file_name>/
Response: Unified diff format text
```

---

## Individual Code Editor

### Purpose
Edit single Python files < 300 KB with full IDE-like experience.

### Access

**From Dashboard:**
- Click **"Edit"** button next to file in Files List

**Direct URL:**
- `/pybirdai/execution-code-editing/edit/joins/<file_name>/`
- Example: `/pybirdai/execution-code-editing/edit/joins/ANCRDT_INSTRMNT_C_1_logic.py/`

**View:** `execution_code_editor_views.edit_execution_code()`

**Template:** `execution_code_editing_workflow/code_editor.html`

### Interface

**Layout:** Two-panel layout with action bar

The Left Panel provides a Code Structure viewer using Abstract Syntax Tree (AST) analysis to give you a tree view of your code's organization. This panel displays classes, methods and functions, and docstrings in a hierarchical format. You can click on any function name to jump directly to that code section, collapse or expand sections as needed, and navigate large files easily without scrolling through the entire document.

The Right Panel features the full Microsoft Monaco Editor, which uses the same engine as VS Code. This powerful editor provides Python syntax highlighting, auto-indentation, error underlining for basic Python syntax issues, line numbers for easy reference, a minimap for large files, find and replace functionality, and multi-cursor editing capabilities for efficient code manipulation.

The Bottom Action Bar contains several buttons for managing your code. The Validate button allows you to check Python syntax before saving. The Save button saves your changes to the staging area without deploying. The Save & Deploy button saves your changes and immediately deploys them to production in a single action. The Cancel button lets you discard your changes and return to the previous screen.

### Usage

#### Open File for Editing

1. From Step 3 Review Dashboard, click **"Edit"** next to desired file
2. Individual Code Editor page loads
3. Left panel shows code structure
4. Right panel shows code content in Monaco Editor

#### Navigate Code Structure

**Using AST viewer (left panel):**
1. Expand class node (e.g., `class ANCRDT_INSTRMNT_C_1`)
2. View list of methods:
   - `__init__(self, context)`
   - `calc_instrmnt_c_1(self, filters=None)`
   - `apply_filters(self, df, filters)`
   - ...
3. Click method name (e.g., `calc_instrmnt_c_1`)
4. Right panel scrolls to that method
5. Cursor positioned at method definition

**Benefits:**
- Quickly find specific functions in large files
- Understand code organization at a glance
- Navigate without scrolling through entire file

#### Edit Code

**In Monaco Editor (right panel):**

1. Click to position cursor
2. Type to edit
3. Use standard editing features:
   - **Copy/Paste:** Ctrl+C / Ctrl+V (Cmd on Mac)
   - **Undo/Redo:** Ctrl+Z / Ctrl+Y
   - **Find:** Ctrl+F
   - **Replace:** Ctrl+H
   - **Comment line:** Ctrl+/
   - **Move line:** Alt+↑/↓
   - **Duplicate line:** Shift+Alt+↓
   - **Multi-cursor:** Alt+Click
   - **Select all occurrences:** Ctrl+Shift+L

**Example edits:**

**Fix join condition:**
```python
# Before
df_result = df_primary.merge(df_foreign, on='INSTRMNT_ID', how='inner')

# After (add additional join key)
df_result = df_primary.merge(df_foreign, on=['INSTRMNT_ID', 'RPRTNG_AGNT'], how='inner')
```

**Add error handling:**
```python
# Before
def calc_instrmnt_c_1(self, filters=None):
    df = self.load_data()
    return df

# After (add try/except)
def calc_instrmnt_c_1(self, filters=None):
    try:
        df = self.load_data()
        return df
    except Exception as e:
        logger.error(f"Error in calc_instrmnt_c_1: {e}")
        raise
```

**Optimize performance:**
```python
# Before (inefficient)
for index, row in df.iterrows():
    df.at[index, 'result'] = row['value'] * 2

# After (vectorized)
df['result'] = df['value'] * 2
```

#### Validate Syntax

1. After making edits, click **"Validate"** button
2. System runs Python syntax check:
   ```python
   try:
       compile(code, '<string>', 'exec')
   except SyntaxError as e:
       return error
   ```
3. Results display:
   - **✓ Success:** "Syntax is valid"
   - **✗ Error:** Shows error message and line number

**Example validation error:**
```
Syntax Error at line 45:
    df_result = df_primary.merge(df_foreign on='INSTRMNT_ID')
                                            ^
SyntaxError: invalid syntax
```

4. If error, fix and validate again
5. Continue until syntax is valid

#### Save Changes

**Save to Staging:**
1. Click **"Save"** button
2. AJAX request saves file to `results/generated_python_joins/`
3. Success message: "File saved successfully"
4. File remains in staging (not deployed)
5. Can continue editing

**Save & Deploy:**
1. Click **"Save & Deploy"** button
2. Confirmation dialog:
   ```
   Save changes and deploy to production?
   This will:
   - Save to staging area
   - Create backup of production file
   - Deploy to production
   Continue?
   ```
3. Click **"Confirm"**
4. System:
   - Saves to staging
   - Validates syntax (blocks if invalid)
   - Creates backup of production file
   - Deploys to production
   - Updates deployment status
5. Success message: "File saved and deployed successfully"
6. Returns to Step 3 Review Dashboard

#### Cancel Editing

1. Click **"Cancel"** button
2. Confirmation if unsaved changes:
   ```
   You have unsaved changes. Discard them?
   ```
3. Click **"Discard"**
4. Returns to Step 3 Review Dashboard

### API Endpoints

**Load file:**
```
GET /pybirdai/execution-code-editing/api/load/joins/<file_name>/
Response: {
  "file_name": "ANCRDT_INSTRMNT_C_1_logic.py",
  "content": "class ANCRDT_INSTRMNT_C_1:...",
  "size": 45632
}
```

**Get AST structure:**
```
GET /pybirdai/execution-code-editing/api/structure/joins/<file_name>/
Response: {
  "classes": [
    {
      "name": "ANCRDT_INSTRMNT_C_1",
      "line": 1,
      "methods": [
        {"name": "__init__", "line": 5},
        {"name": "calc_instrmnt_c_1", "line": 12},
        ...
      ]
    }
  ]
}
```

**Validate syntax:**
```
POST /pybirdai/execution-code-editing/api/validate/
Body: {"code": "Python code..."}
Response: {
  "valid": true,
  "error": null
} or {
  "valid": false,
  "error": "SyntaxError at line 45: ...",
  "line": 45
}
```

**Save file:**
```
POST /pybirdai/execution-code-editing/save/
Body: {
  "file_name": "ANCRDT_INSTRMNT_C_1_logic.py",
  "content": "Updated Python code...",
  "file_type": "joins"
}
Response: {
  "success": true,
  "message": "File saved successfully"
}
```

**Save and deploy:**
```
POST /pybirdai/execution-code-editing/save-and-deploy/
Body: {
  "file_name": "ANCRDT_INSTRMNT_C_1_logic.py",
  "content": "Updated Python code...",
  "file_type": "joins"
}
Response: {
  "success": true,
  "message": "File saved and deployed successfully",
  "backup_created": "ANCRDT_INSTRMNT_C_1_logic.py.backup_20250117_110000"
}
```

### Best Practices

**Before Editing:**
- Read entire file to understand structure
- Identify specific changes needed
- Consider impact on execution

**During Editing:**
- Make small, focused changes
- Test changes incrementally (save, don't deploy yet)
- Add comments for complex logic
- Preserve auto-generated structure when possible

**Before Deploying:**
- Validate syntax
- Review all changes
- Consider testing in Step 4 with filters first
- Document manual changes for future reference

**File Size Limits:**
- < 100 KB: Edit freely
- 100-300 KB: Edit with caution (may be slow)
- > 300 KB: Do not edit in browser (use IDE, upload)

---

## Unified Filter Code Editor

### Purpose
Edit multiple files seamlessly in a single interface with file tree navigation.

### Access

**From Step 3 Review:**
- Scroll to "Unified Filter Code Editor" section
- Editor loads in iframe

**Direct URL:**
- `/pybirdai/filter-code-editor/`
- With file filter: `/pybirdai/filter-code-editor/?f=<hex_encoded_file_list>`
- With default file: `/pybirdai/filter-code-editor/?default_file=smallest`

**View:** `execution_code_editor_views.unified_filter_code_editor()`

**Template:** `execution_code_editing_workflow/unified_filter_code_editor.html`

### Interface

**Layout:** Three-panel layout

**Left Sidebar: File Tree**
- Shows filtered list of ANCRDT files
- File names with size indicators
- Click file to open in editor
- Current file highlighted
- Search/filter files (if available)

**Center Panel: Monaco Editor**
- Full Monaco Editor
- Python syntax highlighting
- Auto-save functionality (saves to staging after 2 seconds of inactivity)
- Change indicator (asterisk * when unsaved)
- All Monaco features available

**Bottom Status Bar:**
- Current file name
- Cursor position (line:column)
- File encoding (UTF-8)
- Save status: "Saved" or "Saving..." or "Unsaved changes *"

### Usage

#### Open Unified Editor

1. Navigate to ANCRDT Step 3 Review
2. Scroll to "Unified Filter Code Editor" section
3. Click **"Open Editor"** link (or editor loads automatically in iframe)
4. Editor interface loads
5. Left sidebar shows all ANCRDT files
6. Smallest file opens by default in center panel

#### Navigate Between Files

1. **Click file in left sidebar:**
   - File content loads in center panel
   - Previous file auto-saved if modified
   - New file syntax highlighting applies

2. **Use keyboard shortcuts (if available):**
   - Ctrl+P: File picker
   - Ctrl+Tab: Next file
   - Ctrl+Shift+Tab: Previous file

#### Edit Multiple Files

1. Open first file from sidebar (e.g., `ANCRDT_INSTRMNT_C_1_logic.py`)
2. Make edits
3. Wait 2 seconds (auto-save triggers)
4. Status bar shows "Saved"
5. Click second file in sidebar (e.g., `ANCRDT_FNNCL_C_2_logic.py`)
6. First file automatically saved
7. Second file loads
8. Make edits
9. Repeat for additional files

**Auto-save behavior:**
- Triggers 2 seconds after last keystroke
- Saves to staging area only (not deployed)
- Status bar updates to "Saving..." then "Saved"
- Asterisk (*) removed from file name

**Manual save:**
- Press Ctrl+S / Cmd+S to force immediate save
- Useful before switching files or closing editor

#### Search Across Files (if available)

1. Press Ctrl+Shift+F
2. Enter search term
3. Results show matches across all files
4. Click result to open file at that location

### Features

**File Filtering:**
- Only shows ANCRDT files (`ANCRDT_*_logic.py`)
- Filters out non-ANCRDT generated code
- Keeps list manageable

**Size Indicators:**
- Small icon/badge next to file name
- Green: < 100 KB
- Yellow: 100-300 KB
- Red: > 300 KB (may be slow to edit)

**Smart Default File:**
- `default_file=smallest`: Opens smallest file first
- Faster initial load
- Less likely to have performance issues

**Session Persistence:**
- Remembers last opened file (localStorage)
- Returns to same file on reload
- Preserves scroll position

### Deployment from Unified Editor

**Workflow:**
1. Edit files in Unified Editor
2. All changes auto-saved to staging
3. Close/exit Unified Editor
4. Return to Step 3 Review Dashboard
5. Use "Deploy All" or individual "Deploy" buttons
6. Files deployed from staging to production

**No direct deployment from Unified Editor:**
- Must use Dashboard to deploy
- Separation between editing and deployment
- Encourages review before deployment

### API Endpoints

**Load file:**
```
GET /pybirdai/filter-code-editor/api/load/
Query params: ?file_path=<relative_path>
Response: {
  "file_name": "ANCRDT_INSTRMNT_C_1_logic.py",
  "content": "Python code...",
  "size": 45632
}
```

**Save file:**
```
POST /pybirdai/filter-code-editor/api/save/
Body: {
  "file_path": "ANCRDT_INSTRMNT_C_1_logic.py",
  "content": "Updated Python code..."
}
Response: {
  "success": true,
  "message": "File saved successfully",
  "timestamp": "2025-01-17T11:00:00"
}
```

### Best Practices

**Workflow:**
- Start with smallest files
- Edit related files together (e.g., all dimension filters)
- Let auto-save work (don't manually save constantly)
- Review changes in Dashboard before deploying

**Performance:**
- Avoid opening very large files (> 300 KB)
- Close editor when done to free browser resources
- Use file filtering to reduce sidebar list

**Organization:**
- Group edits by purpose (e.g., all join condition fixes)
- Document changes in code comments
- Keep track of which files modified

---

## ANCRDT Output Tables Editor

### Purpose
Edit the master `ancrdt_output_tables.py` file that defines output table structures and union logic.

### Access
**URL:** `/pybirdai/edit-ancrdt-output-tables/`

**Embedded:** May be in Step 3 Review as additional tab

**Template:** `execution_code_editing_workflow/edit_ancrdt_output_tables_embed.html`

### File Structure

**File:** `pybirdai/process_steps/ancrdt_output_tables.py`

**Contents:**
```python
class AnaCreditOutputTables:
    """Master class for ANCRDT output table definitions"""

    @staticmethod
    def get_all_tables():
        """Returns list of all ANCRDT output table names"""
        return [
            'INSTRMNT_C_1',
            'FNNCL_C_2',
            'CNTRPRTY_C_3',
            ...
        ]

    @staticmethod
    def get_table_structure(table_name):
        """Returns column definitions for table"""
        structures = {
            'INSTRMNT_C_1': [
                {'name': 'INSTRMNT_ID', 'type': 'VARCHAR(50)'},
                {'name': 'RPRTNG_AGNT', 'type': 'VARCHAR(20)'},
                ...
            ],
            ...
        }
        return structures.get(table_name, [])

    @staticmethod
    def calc_union_tables():
        """Creates union tables from individual outputs"""
        # Union logic
        pass
```

### Usage

1. Navigate to ANCRDT Output Tables Editor
2. File content loads in Monaco Editor
3. Edit table structures or logic:
   - Add new tables to `get_all_tables()`
   - Modify column definitions in `get_table_structure()`
   - Update union logic in `calc_union_tables()`
4. Validate syntax
5. Click **"Save"** to save changes
6. Changes take effect on next execution

### Use Cases

**Add new ANCRDT table:**
1. Add table name to `get_all_tables()` list
2. Define structure in `get_table_structure()` dict
3. Update union logic if needed

**Modify output columns:**
1. Find table in `get_table_structure()`
2. Add/remove/modify column definitions
3. Ensure consistency with generated logic files

**Update union logic:**
1. Modify `calc_union_tables()` method
2. Adjust how individual table outputs combine
3. Test with sample data

---

## Advanced Topics

### Manual Edit Detection

**How it works:**
- When file deployed, system stores hash of content
- On status check, compares current production file hash with stored hash
- If different, marks as "Edited"

**Implications:**
- Edited files show in Dashboard with blue "Edited" status
- Warns before re-deploying (overwrites manual edits)
- Can view diff to see what was manually changed

**Handling manually edited files:**
1. View diff to see changes
2. Decide:
   - **Keep manual edits:** Don't re-deploy from staging
   - **Overwrite manual edits:** Deploy from staging
   - **Merge:** Edit in staging to include manual changes, then deploy

### Backup Management

**Automatic backups:**
- Created before every deployment
- Timestamped filename
- Stored in `pybirdai/process_steps/filter_code/backups/`

**Manual restore:**
1. Navigate to backup directory
2. Find desired backup (by timestamp)
3. Copy to staging or production as needed
4. Rename to remove `.backup_<timestamp>` suffix

**Backup cleanup:**
- Backups accumulate over time
- Manually delete old backups if disk space concern
- Consider keeping last 5-10 backups per file

### Large File Handling

**For files > 300 KB:**
- Cannot edit in browser (too slow)
- Use external IDE (VS Code, PyCharm, etc.)
- Edit locally
- Upload to staging area manually
- Deploy via Dashboard

**Upload process:**
1. Edit file in local IDE
2. Save to local directory
3. Use file upload feature (if available) or
4. SCP/SFTP to server `results/generated_python_joins/`
5. Deploy via Dashboard

### Testing Edited Code

**Before deploying:**
1. Save to staging
2. Manually test import:
   ```bash
   cd birds_nest
   python manage.py shell
   ```
   ```python
   import sys
   sys.path.insert(0, 'results/generated_python_joins/')
   from ANCRDT_INSTRMNT_C_1_logic import ANCRDT_INSTRMNT_C_1
   # Test instantiation and methods
   ```
3. Fix any import or runtime errors
4. Re-save and test again
5. When working, deploy to production

**After deploying:**
1. Navigate to ANCRDT Step 4
2. Select table
3. Apply restrictive filters (small data set)
4. Execute
5. Verify results
6. If successful, execute with larger data sets

---

## Troubleshooting

### Common Issues

**Issue: Monaco Editor not loading**
- **Solution:** Check internet connection (Monaco CDN-hosted)
- Disable browser extensions
- Clear browser cache
- Try different browser
- Check browser console for errors

**Issue: Auto-save not working in Unified Editor**
- **Solution:** Check JavaScript console for errors
- Verify CSRF token is present
- Try manual save (Ctrl+S)
- Check network tab for failed AJAX requests

**Issue: Deploy fails with "File not found"**
- **Solution:** Verify file exists in staging area
- Check file path and name (case-sensitive)
- Refresh deployment status
- Check server logs for specific error

**Issue: Syntax validation passes but execution fails**
- **Solution:** Browser validation is basic (syntax only)
- Runtime errors not caught until execution
- Test imports in Python shell
- Review execution logs in Step 4
- Check for logic errors (not syntax errors)

**Issue: Backup not created during deployment**
- **Solution:** Check write permissions on backup directory
- Verify disk space available
- Review deployment logs
- Check `create_backup` parameter is true

**Issue: Cannot edit file - "File too large" message**
- **Solution:** File > 300 KB limit for browser
- Use external IDE to edit
- Consider splitting file into modules
- Optimize code to reduce size

**Issue: Changes not taking effect in Step 4 execution**
- **Solution:** Verify file is deployed (not just saved to staging)
- Check deployment status shows "Synced"
- Verify correct file is imported in execution
- Clear Python cache: `find . -name "*.pyc" -delete`
- Restart Django server if persistent

### Performance Issues

**Editor slow to load:**
- File may be very large
- Close other browser tabs
- Use Individual Editor instead of Unified Editor
- Consider editing largest files externally

**Auto-save laggy:**
- Reduce auto-save frequency (if configurable)
- Use manual save instead
- Edit smaller files first
- Check browser resources (memory, CPU)

---

## Next Steps

After editing and deploying your code, continue with related workflow processes. Return to the [Main Workflow Guide](user-guide/main-workflow-guide.html) to understand how code editing fits into the complete FINREP regulatory reporting workflow. Review the [Dataset Transformation Guide](user-guide/dataset-transformation-guide.html) to see how the code management system integrates with Steps 0-3 of the AnaCredit transformation process.

## Support Resources

- Eclipse EFBT Wiki: https://github.com/eclipse/efbt/wiki
- Getting Started: https://github.com/eclipse-efbt/efbt/wiki/Getting-Started-with-PyBIRD-AI
- Monaco Editor Docs: https://microsoft.github.io/monaco-editor/
